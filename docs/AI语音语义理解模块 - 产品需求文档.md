# AI语音语义理解模块 - 产品需求文档 (PRD)

**版本**：v2.1
**日期**：2026-01-08
**状态**：已发布

---

## 1. 项目背景与目标

### 1.1. 项目背景
本项目最初旨在为智能微波炉提供基于大模型（LLM）的语音控制能力，解决传统指令式语音助手僵化、理解能力差的问题。随着业务发展，系统演进为通用的 **AI 语音语义理解中台**，支持多模型路由、知识库问答（RAG）和实时联网搜索，并配套了完善的管理后台用于调试与评测。

### 1.2. 核心目标
1.  **精准指令控制**：支持复杂的微波炉操作指令（如“大火加热5分钟”、“口感要软糯一点”），准确率 > 95%。
2.  **智能知识问答**：基于产品说明书和食谱，回答用户关于烹饪方法、故障排查的问题。
3.  **实时信息获取**：支持查询天气、新闻等实时信息，扩展设备能力边界。
4.  **可观测与可运营**：提供管理后台，支持会话调试、批量评测和指令配置，降低运维门槛。
5.  **商业化 SaaS 能力 (v2.1 New)**：支持多租户隔离、用户账户体系和高级 RAG 配置，满足商业交付标准。

---

## 2. 用户角色 (User Roles)

| 角色 | 描述 | 核心场景 |
| :--- | :--- | :--- |
| **终端用户 (End User)** | 购买并使用智能设备的用户 | 语音控制设备、询问食谱、查询天气 |
| **运营人员 (Operator)** | 负责配置指令和知识库的人员 | 上传产品文档、配置新指令、查看对话日志 |
| **测试人员 (QA)** | 负责系统质量评估的人员 | 批量上传测试用例、查看评测报告、回归测试 |
| **开发人员 (Dev)** | 负责系统维护和二次开发 | 查看 API Trace、调试 Prompt、切换模型配置 |
| **租户管理员 (Tenant Admin)** | 负责管理本租户下的用户和数据 | 登录系统、管理知识库配置、查看本租户数据 |

---

## 3. 功能需求 (Functional Requirements)

### 3.1. 语音语义理解 (Core NLU)

#### 3.1.1. 多意图路由 (Intent Routing)
系统需根据用户输入的文本，自动识别并路由至以下三类意图之一：
*   **指令控制 (Instruction)**：设备操作类请求。
*   **知识问答 (RAG)**：关于设备使用、食谱等客观知识的询问。
*   **通用闲聊 (Chat)**：天气查询、日常闲聊等开放域问题。

#### 3.1.2. 指令解析 (Instruction Parsing)
*   **支持指令集**：需支持 `Optimized_AI_Voice_Solution.docx` 中定义的 40+ 种指令，包括但不限于：
    *   `set_firepower`: 设置火力 (大火/中火/小火)
    *   `set_cooking_time`: 设置时长
    *   `set_taste`: 设置口感 (软糯/脆爽/Q弹)
    *   `set_foodtype`: 设置食材类型
    *   `open_door` / `pause_cooking` / `stop_cooking`: 设备控制
*   **参数补全**：能从上下文中自动补全缺失参数（如“再加一分钟”需补全当前模式）。
*   **互斥处理**：识别并拒绝冲突指令（如“解冻模式下设置大火”）。

#### 3.1.3. 知识库问答 (RAG)
*   支持上传 PDF/Word/TXT 格式的产品说明书和食谱。
*   支持基于向量检索（Vector Search）的精准问答。
*   **降级策略**：当检索结果置信度低时，自动回退到通用大模型回答。

#### 3.1.4. 实时联网搜索 (Web Search)
*   **场景**：当用户询问天气、新闻、汇率等实时信息时触发。
*   **能力**：调用 DuckDuckGo/Tavily API 获取搜索结果，并由 LLM 总结回答。
*   **展示**：在管理后台展示参考来源链接。

---

### 3.2. 管理后台 (Admin Dashboard)

#### 3.2.1. 用户系统与租户隔离 (User System) **(v2.1 New)**
*   **简易登录**：支持手机号登录（无需验证码，仅作为唯一标识）。
*   **数据隔离**：所有数据（会话、知识库、指令、评测记录）均与 `user_id` 绑定。
*   **会话隔离**：不同用户只能看到自己的数据，互不干扰。

#### 3.2.2. 聊天调试台 (Chat Debugger)
*   **界面风格**：Manus Style (深色、极简、胶囊标签)。
*   **多会话管理**：支持创建、重命名、删除多个独立会话，历史记录持久化存储。
*   **Traceability Badges**：在每条 AI 回复上方显示胶囊标签，标识：
    *   **Intent**: Instruction / RAG / Chat
    *   **Model**: Qwen-Max / GPT-4o / Minimax-M2
    *   **Latency**: 耗时 (ms)
    *   **Search**: 是否触发搜索
*   **元数据面板**：侧边栏展示完整的 JSON Metadata，包括搜索源链接、RAG 引用片段。

#### 3.2.3. 批量评测 (Batch Evaluation)
*   **Excel 上传**：支持上传包含 `case_id`, `query`, `expected_intent`, `expected_keywords` 的测试用例。
*   **自动执行**：后端并发执行测试用例。
*   **报告生成**：生成包含 `Pass/Fail` 状态、`Actual Intent`、`Actual Reply`、`Latency` 的结果 Excel。
*   **指标统计**：自动计算准确率 (Accuracy) 和平均耗时 (Avg Latency)。

#### 3.2.4. 知识库管理 (Knowledge Base) **(v2.1 Updated)**
*   **文件管理**：支持文件上传、列表展示、删除、状态查看（索引中/已完成/失败）。
*   **高级配置 (RAG Settings)**：
    *   **索引模式 (Indexing Mode)**：高质量 (High Quality) / 经济 (Economy)。
    *   **检索设置 (Retrieval Settings)**：向量检索 (Vector) / 全文检索 (Full-Text) / 混合检索 (Hybrid)。
    *   **重排序 (Rerank)**：开启/关闭 Rerank 模型，设置 Top K 和 Score 阈值。
*   **召回测试 (Recall Test)**：
    *   输入测试文本，实时展示检索到的 Top K 文档片段及其相似度得分。
    *   用于验证当前配置下的检索效果。

#### 3.2.5. 指令管理 (Instruction Mgmt)
*   支持通过 Excel 批量导入指令定义（Function Calling Schema）。
*   在线查看和编辑指令参数。

---

## 4. 非功能需求 (Non-Functional Requirements)

### 4.1. 性能指标
*   **首字延迟 (TTFT)**：< 1.5s (流式模式下)。
*   **端到端延迟**：< 3s (复杂指令解析)。
*   **并发支持**：支持 50 QPS。

### 4.2. 准确率指标
*   **意图分类准确率**：> 98%。
*   **指令解析准确率**：> 95%。
*   **RAG 检索准确率**：Top-3 Recall > 90%。

### 4.3. 可扩展性
*   支持通过配置项 (`.env`) 动态切换不同厂商的大模型（OpenAI, Qwen, Minimax）。
*   支持热插拔式增加新的 Tool/Function。

---

## 5. 附录：指令集定义 (部分)

*(源自 Optimized_AI_Voice_Solution.docx)*

| 指令名称 | 描述 | 关键参数 |
| :--- | :--- | :--- |
| `set_taste` | 设置口感 | `taste` (enum: 软糯, 脆爽...), `food` |
| `set_food_cooking_temp` | 设置烹饪温度 | `cooking_temp` (20-100), `food` |
| `set_theme_previous` | 切换回上一个主题 | - |
| `AI_cooking_page_open` | 打开智能烹饪页 | - |
| `DIY_cooking_page_open` | 打开自助烹饪页 | - |
| ... | ... | ... |
